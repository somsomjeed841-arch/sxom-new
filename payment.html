<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Up - SXOM JEXM</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #d8ccc2; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        
        .container { width: 100%; max-width: 450px; background: #f3eee9; padding: 30px; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); text-align: center; }
        
        /* Tab Styling */
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; background: #ede5df; padding: 5px; border-radius: 15px; }
        .tab { flex: 1; padding: 10px; border-radius: 12px; cursor: pointer; transition: 0.3s; font-weight: 600; color: #8c6b5a; font-size: 14px; }
        .tab.active { background: #8c6b5a; color: white; }

        .method-content { display: none; animation: fadeIn 0.4s ease; }
        .method-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .qr-section { background: white; padding: 15px; border-radius: 20px; display: inline-block; margin: 15px 0; }
        .qr-img { width: 180px; height: 180px; object-fit: contain; }

        .upload-area { border: 2px dashed #d1c4bc; border-radius: 20px; padding: 20px; background: #ede5df; margin: 20px 0; }
        
        .btn-verify { background: #8c6b5a; color: white; border: none; padding: 15px; border-radius: 15px; width: 100%; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-verify:hover { background: #3e2f27; transform: translateY(-2px); }
        .btn-verify:disabled { background: #ccc; }

        .status { margin-top: 15px; font-size: 14px; font-weight: 500; }
        .btn-back { margin-top: 20px; display: inline-block; text-decoration: none; color: #8c6b5a; font-size: 13px; }
    </style>
</head>
<body>

<div class="container">
    <h2>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <p style="color:#8c6b5a; font-size:13px; margin-bottom:20px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</p>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('bank')">üè¶ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</div>
        <div class="tab" onclick="switchTab('wallet')">üí≥ TrueMoney</div>
    </div>

    <div id="bank-content" class="method-content active">
        <div class="qr-section">
            <img src="QRCode_20260302224649.png" class="qr-img" alt="Bank QR">
        </div>
        <p style="font-size:13px;">‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÅ‡∏≠‡∏õ</p>
    </div>

    <div id="wallet-content" class="method-content">
        <div class="qr-section" style="border: 2px solid #ff6000;">
            <img src="IMG_0517.png" class="qr-img" alt="Wallet QR">
        </div>
        <p style="font-size:13px; color:#ff6000;"‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ TrueMoney</p>
    </div>

    <div class="upload-area">
        <p style="font-size:13px; margin-bottom:10px;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ</p>
        <input type="file" id="slipInput" accept="image/*">
    </div>

    <button id="uploadBtn" class="btn-verify" onclick="verifyAndTopup()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
    <div id="status" class="status"></div>

    <a href="shop.html" class="btn-back">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="module">
    // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
    
    const firebaseConfig = { apiKey: "AIzaSyAj1kaFq20fAoypR-J-OSJdqPAWMLXGHVg", authDomain: "sxom-new.firebaseapp.com", projectId: "sxom-new" };
    const SUPABASE_URL = 'https://rjjtksrjbiifgffhefdt.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJqanRrc3JqYmlpZmdmZmhlZmR0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzI0NTE0MTcsImV4cCI6MjA4ODAyNzQxN30.36PRBK4fxC2rA-VMvQVfI_p0U4BVsO3pGY38e31XZAI';
    
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const auth = getAuth(initializeApp(firebaseConfig));
    let currentUserId = null;

    onAuthStateChanged(auth, (user) => { if (user) currentUserId = user.uid; else window.location.href="index.html"; });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö Tab
    window.switchTab = function(method) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.method-content').forEach(c => c.classList.remove('active'));
        
        event.currentTarget.classList.add('active');
        document.getElementById(method + '-content').classList.add('active');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ (‡πÉ‡∏ä‡πâ API ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
    window.verifyAndTopup = async function() {
        const fileInput = document.getElementById('slipInput');
        const statusDiv = document.getElementById('status');
        const btn = document.getElementById('uploadBtn');

        if (!fileInput.files[0]) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ‡∏Ñ‡∏£‡∏±‡∏ö");

        btn.disabled = true;
        statusDiv.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ...";
        statusDiv.style.color = "#3e2f27";

        const formData = new FormData();
        formData.append('files', fileInput.files[0]);

        try {
            const response = await fetch('https://api.slipok.com/api/v1/main/verify/', {
                method: 'POST',
                headers: { 'x-authorization': 'SLIPOK0IHUY7U' },
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                const amount = result.data.amount;
                const { data: profile } = await _supabase.from('profiles').select('balance').eq('id', currentUserId).single();
                const newBalance = (profile.balance || 0) + amount;

                await _supabase.from('profiles').update({ balance: newBalance }).eq('id', currentUserId);

                statusDiv.style.color = "green";
                statusDiv.innerText = `‚úÖ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ø${amount}`;
                setTimeout(() => window.location.href="shop.html", 1500);
            } else {
                statusDiv.style.color = "red";
                statusDiv.innerText = "‚ùå ‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß";
            }
        } catch (err) {
            statusDiv.innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
        } finally {
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
